function WebGlContext(t){this.canvas=t,this.c=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.c.viewport(0,0,this.canvas.width,this.canvas.height),this.textureUnit=-1,this.elements=[],this.MatrixMath={translation:function(t,i,e){return[1,0,0,0,0,1,0,0,0,0,1,0,t,i,e,1]},xRotation:function(t){var i=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]},yRotation:function(t){var i=Math.cos(t),e=Math.sin(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]},zRotation:function(t){var i=Math.cos(t),e=Math.sin(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,i,e){return[t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1]},mult:function(t,i){var e=i[0],s=i[1],r=i[2],h=i[3],c=i[4],a=i[5],n=i[6],E=i[7],T=i[8],o=i[9],u=i[10],_=i[11],R=i[12],l=i[13],f=i[14],A=i[15],m=t[0],U=t[1],x=t[2],M=t[3],P=t[4],b=t[5],d=t[6],g=t[7],v=t[8],X=t[9],C=t[10],B=t[11],I=t[12],F=t[13],S=t[14],D=t[15];return[e*m+s*P+r*v+h*I,e*U+s*b+r*X+h*F,e*x+s*d+r*C+h*S,e*M+s*g+r*B+h*D,c*m+a*P+n*v+E*I,c*U+a*b+n*X+E*F,c*x+a*d+n*C+E*S,c*M+a*g+n*B+E*D,T*m+o*P+u*v+_*I,T*U+o*b+u*X+_*F,T*x+o*d+u*C+_*S,T*M+o*g+u*B+_*D,R*m+l*P+f*v+A*I,R*U+l*b+f*X+A*F,R*x+l*d+f*C+A*S,R*M+l*g+f*B+A*D]},orthographic:function(t,i,e,s,r,h){return[2/(i-t),0,0,0,0,2/(s-e),0,0,0,0,2/(r-h),0,(t+i)/(t-i),(e+s)/(e-s),(r+h)/(r-h),1]},perspective:function(t,i,e,s){var r=Math.tan(.5*Math.PI-.5*t),h=1/(e-s);return[r/i,0,0,0,0,r,0,0,0,0,(e+s)*h,-1,0,0,e*s*h*2,0]}},this.adjustScreen=function(){this.c=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.c.viewport(0,0,this.canvas.width,this.canvas.height)},this.clearColor=function(t,i,e,s){this.c.clearColor(t,i,e,s)},this.enableDepthtest=function(){this.c.enable(this.c.DEPTH_TEST)},this.disableDepthtest=function(){this.c.disable(this.c.DEPTH_TEST)},this.enableCullface=function(){this.c.enable(this.c.CULL_FACE)},this.disableCullface=function(){this.c.disable(this.c.CULL_FACE)},this.clear=function(){this.c.clear(this.c.COLOR_BUFFER_BIT),this.c.clear(this.c.DEPTH_BUFFER_BIT)},this.createAttribute=function(t,i){return{name:t,size:i}},this.createUniform=function(t,i){return"sampler2D"==i?(this.textureUnit+=1,{name:t,type:i,width:0,height:0,data:null,texture:this.c.createTexture(),value:this.textureUnit}):"samplerCube"==i?(this.textureUnit+=1,{name:t,type:i,width:0,height:0,data:null,texture:this.c.createTexture(),value:this.textureUnit}):{name:t,type:i,value:null}},this.setTextureToImage=function(t,i){var e=new Image;new URL(i,window.location.href).origin!==window.location.origin&&(e.crossOrigin=""),e.src=i,e.c=this.c,e.uniform=t,e.onload=function(){this.uniform.width=this.width,this.uniform.height=this.height,this.c.bindTexture(this.c.TEXTURE_2D,this.uniform.texture),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_WRAP_S,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_WRAP_T,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_MIN_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_MAG_FILTER,this.c.NEAREST),this.c.texImage2D(this.c.TEXTURE_2D,0,this.c.RGBA,this.c.RGBA,this.c.UNSIGNED_BYTE,e)}},this.setTexture=function(t,i,e,s){this.c.bindTexture(this.c.TEXTURE_2D,t.texture),this.c.pixelStorei(this.c.UNPACK_ALIGNMENT,1),t.width=i,t.height=e,null===s?this.c.texImage2D(this.c.TEXTURE_2D,0,this.c.RGBA,i,e,0,this.c.RGBA,this.c.UNSIGNED_BYTE,null):this.c.texImage2D(this.c.TEXTURE_2D,0,this.c.RGBA,i,e,0,this.c.RGBA,this.c.UNSIGNED_BYTE,new Uint8Array(s)),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_MIN_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_MAG_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_WRAP_S,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_2D,this.c.TEXTURE_WRAP_T,this.c.CLAMP_TO_EDGE)},this.setCubeSideToImage=function(t,i,e){var s=new Image;new URL(e,window.location.href).origin!==window.location.origin&&(s.crossOrigin=""),s.src=e,s.c=this.c,s.side=i,s.uniform=t,s.onload=function(){this.uniform.width=this.width,this.uniform.height=this.height,this.c.bindTexture(this.c.TEXTURE_CUBE_MAP,this.uniform.texture),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_WRAP_S,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_WRAP_T,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_MIN_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_MAG_FILTER,this.c.NEAREST);var t=this.c.TEXTURE_CUBE_MAP_POSITIVE_X;switch(i.toLocaleLowerCase()){case"x":case"+x":t=this.c.TEXTURE_CUBE_MAP_POSITIVE_X;break;case"-x":t=this.c.TEXTURE_CUBE_MAP_NEGATIVE_X;break;case"y":case"+y":t=this.c.TEXTURE_CUBE_MAP_POSITIVE_Y;break;case"-y":t=this.c.TEXTURE_CUBE_MAP_NEGATIVE_Y;break;case"z":case"+z":t=this.c.TEXTURE_CUBE_MAP_POSITIVE_Z;break;case"-z":t=this.c.TEXTURE_CUBE_MAP_NEGATIVE_Z}this.c.texImage2D(t,0,this.c.RGBA,this.c.RGBA,this.c.UNSIGNED_BYTE,this)}},this.setCubeSide=function(t,i,e,s,r){this.c.bindTexture(this.c.TEXTURE_CUBE_MAP,t.texture),this.c.pixelStorei(this.c.UNPACK_ALIGNMENT,1),0!=t.width&&0!=t.height?e==t.width&&s==t.height||console.log("textures in samplerCube need to be of same size!"):(t.width=e,t.height=s);var h=this.c.TEXTURE_CUBE_MAP_POSITIVE_X;switch(i.toLocaleLowerCase()){case"x":case"+x":h=this.c.TEXTURE_CUBE_MAP_POSITIVE_X;break;case"-x":h=this.c.TEXTURE_CUBE_MAP_NEGATIVE_X;break;case"y":case"+y":h=this.c.TEXTURE_CUBE_MAP_POSITIVE_Y;break;case"-y":h=this.c.TEXTURE_CUBE_MAP_NEGATIVE_Y;break;case"z":case"+z":h=this.c.TEXTURE_CUBE_MAP_POSITIVE_Z;break;case"-z":h=this.c.TEXTURE_CUBE_MAP_NEGATIVE_Z}this.c.texImage2D(h,0,this.c.RGBA,e,s,0,this.c.RGBA,this.c.UNSIGNED_BYTE,new Uint8Array(r)),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_MIN_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_MAG_FILTER,this.c.NEAREST),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_WRAP_S,this.c.CLAMP_TO_EDGE),this.c.texParameteri(this.c.TEXTURE_CUBE_MAP,this.c.TEXTURE_WRAP_T,this.c.CLAMP_TO_EDGE)},this.createCamera=function(){return{x:0,y:0,z:0,xRotation:0,yRotation:0,zRotation:0,projectionMatrix:this.MatrixMath.orthographic(-1,1,-1,1,-1,1)}},this.createElement=function(){return{program:null,x:0,y:0,z:0,xRotation:0,yRotation:0,zRotation:0,attributes:[],uniforms:[],vertices:[],indicies:[],camera:this.createCamera()}},this.addShaders=function(t,i,e){t.program=this.createProgram(i,e)},this.addElement=function(t){this.elements.includes(t)||this.elements.push(t)},this.removeElement=function(t){var i=this.elements.indexOf(t);return-1!=i&&(this.elements.splice(i,1),!0)},this.renderElement=function(t){this.c.useProgram(t.program),this.createBuffers(t.program,t.vertices,t.attributes,t.indicies);for(var i=0;i<t.uniforms.length;i++){var e=this.c.getUniformLocation(t.program,t.uniforms[i].name),s=t.uniforms[i].value;switch(t.uniforms[i].type){case"float":this.c.uniform1f(e,s);break;case"vec2":this.c.uniform2fv(e,new Float32Array(s));break;case"vec3":this.c.uniform3fv(e,new Float32Array(s));break;case"vec4":this.c.uniform4fv(e,new Float32Array(s));break;case"mat2":this.c.uniformMatrix2fv(e,this.c.FALSE,new Float32Array(s));break;case"mat3":this.c.uniformMatrix3fv(e,this.c.FALSE,new Float32Array(s));break;case"mat4":this.c.uniformMatrix4fv(e,this.c.FALSE,new Float32Array(s));break;case"int":this.c.uniform1i(e,s);break;case"ivec2":this.c.uniform2iv(e,new Int32Array(s));break;case"ivec3":this.c.uniform3iv(e,new Int32Array(s));break;case"ivec4":this.c.uniform4iv(e,new Int32Array(s));break;case"sampler2D":this.c.uniform1i(e,s),this.bindTexture(t.uniforms[i],s);break;case"samplerCube":this.c.uniform1i(e,s),this.bindTexture(t.uniforms[i],s)}}var r=this.MatrixMath.mult(this.MatrixMath.mult(this.MatrixMath.mult(this.MatrixMath.yRotation(t.camera.yRotation),this.MatrixMath.xRotation(t.camera.xRotation)),this.MatrixMath.zRotation(t.camera.zRotation)),this.MatrixMath.translation(t.camera.x,t.camera.y,t.camera.z)),h=this.MatrixMath.mult(t.camera.projectionMatrix,r);e=this.c.getUniformLocation(t.program,"projectionMatrix");this.c.uniformMatrix4fv(e,this.c.FALSE,new Float32Array(h)),this.c.drawElements(this.c.TRIANGLES,t.indicies.length,this.c.UNSIGNED_SHORT,0)},this.renderFrame=function(){for(var t=0;t<this.elements.length;t++)this.renderElement(this.elements[t])},this.setTarget=function(t){if(null===t)this.c.bindFramebuffer(this.c.FRAMEBUFFER,null),this.c.bindRenderbuffer(this.c.RENDERBUFFER,null),this.adjustScreen();else{for(var i=0;i<=this.textureUnit;i++)this.bindTexture(null,i);var e=this.c.createFramebuffer();this.c.bindFramebuffer(this.c.FRAMEBUFFER,e),this.c.framebufferTexture2D(this.c.FRAMEBUFFER,this.c.COLOR_ATTACHMENT0,this.c.TEXTURE_2D,t.texture,0);var s=this.c.createRenderbuffer();this.c.bindRenderbuffer(this.c.RENDERBUFFER,s),this.c.renderbufferStorage(this.c.RENDERBUFFER,this.c.DEPTH_COMPONENT16,t.width,t.height),this.c.framebufferRenderbuffer(this.c.FRAMEBUFFER,this.c.DEPTH_ATTACHMENT,this.c.RENDERBUFFER,s),this.c.viewport(0,0,t.width,t.height)}},this.bindTexture=function(t,i){if(null===t){var e=this.c.TEXTURE0+i;this.c.activeTexture(e),this.c.bindTexture(this.c.TEXTURE_2D,null)}else if("sampler2D"==t.type){e=this.c.TEXTURE0+t.value;this.c.activeTexture(e),this.c.bindTexture(this.c.TEXTURE_2D,t.texture)}else if("samplerCube"==t.type){e=this.c.TEXTURE0+t.value;this.c.activeTexture(e),this.c.bindTexture(this.c.TEXTURE_CUBE_MAP,t.texture)}},this.createShader=function(t,i){var e=this.c.createShader(i);return this.c.shaderSource(e,t),this.c.compileShader(e),this.c.getShaderParameter(e,this.c.COMPILE_STATUS)?e:(console.log(this.c.getShaderInfoLog(e)),null)},this.createProgram=function(t,i){var e=this.createShader(t,this.c.VERTEX_SHADER),s=this.createShader(i,this.c.FRAGMENT_SHADER);if(null===e||null===s)return null;var r=this.c.createProgram();return this.c.attachShader(r,e),this.c.attachShader(r,s),this.c.linkProgram(r),this.c.getProgramParameter(r,this.c.LINK_STATUS)?r:(console.log(this.c.getProgramInfoLog(r)),null)},this.createBuffers=function(t,i,e,s){var r=this.c.createBuffer();this.c.bindBuffer(this.c.ARRAY_BUFFER,r),this.c.bufferData(this.c.ARRAY_BUFFER,new Float32Array(i),this.c.DYNAMIC_DRAW);var h=this.c.createBuffer();this.c.bindBuffer(this.c.ELEMENT_ARRAY_BUFFER,h),this.c.bufferData(this.c.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),this.c.DYNAMIC_DRAW);for(var c=0,a=0;a<e.length;a++)c+=e[a].size;var n=0;for(a=0;a<e.length;a++){var E=this.c.getAttribLocation(t,e[a].name);this.c.vertexAttribPointer(E,e[a].size,this.c.FLOAT,this.c.FALSE,c*Float32Array.BYTES_PER_ELEMENT,n*Float32Array.BYTES_PER_ELEMENT),this.c.enableVertexAttribArray(E),n+=e[a].size}}}